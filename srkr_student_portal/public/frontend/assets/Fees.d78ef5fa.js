import{k as M,g as P,f as x,l as A,r as q,o as n,c as _,b as C,w as v,a as w,F as D,m as E,n as N,t as O,q as d,u as r,v as U,x as b,y as j,s as L,z as T,i as G,A as H,B as J,C as K,E as Q}from"./index.bfcebbd6.js";import{E as I}from"./ErrorMessage.53926b1f.js";import{c as z}from"./index.39eeab0c.js";import{_ as W}from"./MissingData.51a37aa2.js";const X={class:"flex flex-col gap-4"},Y={class:"grid grid-cols-2 gap-4"},Z={class:"mb-2 text-sm text-gray-600"},ee={class:"flex flex-row-reverse gap-2"},te={__name:"FeesPaymentDialog",props:{modelValue:{type:Boolean,required:!1},student:{type:Object,required:!0},row:{type:Object,required:!0}},emits:["update:modelValue","success"],setup(F,{emit:B}){const o=F,S=B;M(()=>{const a=document.createElement("script");a.src="https://checkout.razorpay.com/v1/checkout.js",document.body.appendChild(a)});const c=P({url:"education.education.billing.get_payment_options",makeParams(a){return{doctype:"Sales Invoice",docname:o.row.invoice,phone:e.mobile_number,country:e.country}}}),g=P({url:"education.education.billing.handle_payment_success"}),f=P({url:"education.education.billing.handle_payment_failure"});function V(a){if(!e.mobile_number||!e.email){k();return}c.submit({},{onSuccess(t){t.handler=u=>{$(u,a)};let y=new Razorpay(t);y.open(),y.on("payment.failed",u=>R(u)),y.on("payment.success",u=>$(u,a))},onError(t){s(t)}})}function k(){e.mobile_number||(i.value=!1),e.email||(m.value=!1),e.mobile_number&&!e.email&&(i.value=!0,m.value=!1),e.email&&!e.mobile_number&&(m.value=!0,i.value=!1),e.email&&e.mobile_number&&(m.value=!0,i.value=!0)}function $(a,t){g.submit({response:a,against_invoice:o.row.invoice,billing_details:e},{onSuccess(y){t(),S("success")},onError(y){s(y)}})}function R(a){f.submit({response:a,against_invoice:o.row.invoice,billing_details:e},{onError(t){s(t)}})}function s(a){console.log(a),z({message:"Something went wrong",icon:"x",iconClasses:"text-red-600"})}const i=x(!0),m=x(!0),e=A({program:o.row.program||"",student:o.student.student_name||"",amount:o.row.amount||"",id:o.student.name||"",mobile_number:"",email:o.student.student_email_id||"",address_line_1:o.student.address_line_1||"",address_line_2:o.student.address_line_2||"",city:o.student.city||"",state:o.student.state||"",country:o.student.country||"",pincode:o.student.pincode||""}),p=[{section:"Student Details",fields:[{label:"Student",name:"student",type:"data",readonly:!0},{label:"Student",name:"id",type:"data",readonly:!0},{label:"Amount",name:"amount",type:"data",readonly:!0},{label:"Program",name:"program",type:"data",readonly:!0},{label:"Mobile Number",name:"mobile_number",type:"data"},{label:"Email",name:"email",type:"data"}]},{section:"Student Address",fields:[{label:"Address Line 1",name:"address_line_1",type:"data"},{label:"Address Line 2",name:"address_line_2",type:"data"},{label:"City",name:"city",type:"data"},{label:"State",name:"state",type:"data"},{label:"Country",name:"country",type:"data"},{label:"Pincode",name:"pincode",type:"data"}]}];return(a,t)=>{const y=q("Button");return n(),_("div",null,[C(r(j),{options:{title:"Pay Fees",actions:[{label:"Save",variant:"solid"}]},modelValue:F.modelValue,"onUpdate:modelValue":t[2]||(t[2]=u=>S("update:modelValue",u))},{"body-content":v(()=>[w("div",X,[(n(),_(D,null,E(p,u=>w("div",{key:u.section},[w("div",Y,[(n(!0),_(D,null,E(u.fields,l=>(n(),_("div",{key:l.name,class:N(l.hidden&&"hidden")},[w("div",Z,O(l.label),1),l.name==="mobile_number"||l.name==="email"?(n(),d(r(U),{key:0,type:l.type,modelValue:e[l.name],"onUpdate:modelValue":h=>e[l.name]=h,placeholder:l.placeholder,disabled:l.readonly,onChange:t[0]||(t[0]=h=>k())},null,8,["type","modelValue","onUpdate:modelValue","placeholder","disabled"])):(n(),d(r(U),{key:1,type:l.type,modelValue:e[l.name],"onUpdate:modelValue":h=>e[l.name]=h,placeholder:l.placeholder,disabled:l.readonly,onChange:t[1]||(t[1]=h=>k())},null,8,["type","modelValue","onUpdate:modelValue","placeholder","disabled"])),l.name==="mobile_number"&&!i.value?(n(),d(r(I),{key:2,message:"Mobile number is required",class:"pt-2"})):b("",!0),l.name==="email"&&!m.value?(n(),d(r(I),{key:3,message:"Email is Required",class:"pt-2"})):b("",!0)],2))),128))])])),64))])]),actions:v(({close:u})=>[w("div",ee,[C(y,{class:"w-48 h-7",variant:"solid",onClick:l=>V(u),"icon-left":"external-link",loading:r(c).loading,label:"Proceed to Payment"},null,8,["onClick","loading"])])]),_:1},8,["modelValue"])])}}},ae={key:0,class:"px-5 py-4"},ne={key:1},re={__name:"Fees",setup(F){const{getStudentInfo:B}=L();let o=B().value;const S=P({url:"education.education.api.get_student_invoices",params:{student:o.name},onSuccess:s=>{V=s==null?void 0:s.print_format;let i=s==null?void 0:s.invoices;i=i.sort((m,e)=>{const p={Overdue:0,Unpaid:1,Paid:2},a=p[m.status],t=p[e.status];if(a!==t)return a-t}),c.rows=i},auto:!0}),c=A({rows:[],columns:[{label:"Program",key:"program",width:1},{label:"Status",key:"status",width:1},{label:"Payment Date",key:"payment_date",width:1},{label:"Due Date",key:"due_date",width:1},{label:"Amount",key:"amount",width:1},{label:"Invoice",key:"cta",width:1}]}),g=x(null),f=x(!1);let V="Standard";const k=s=>{let i=`/api/method/frappe.utils.print_format.download_pdf?
		doctype=${encodeURIComponent("Sales Invoice")}
		&name=${encodeURIComponent(s.invoice)}
		&format=${encodeURIComponent(V)}
	`;window.open(i,"_blank")},$=s=>{g.value=s,f.value=!0},R=()=>{S.reload(),z({title:"Payment Successful",icon:"check",iconClasses:"text-green-600"})};return(s,i)=>{const m=q("Button");return c.rows.length>0?(n(),_("div",ae,[c.rows.length>0?(n(),d(r(G),{key:0,columns:c.columns,rows:c.rows,options:{selectable:!1,showTooltip:!1,onRowClick:()=>{}},"row-key":"id"},{default:v(()=>[C(r(T),null,{default:v(()=>[(n(!0),_(D,null,E(c.columns,e=>(n(),d(r(H),{key:e.key,item:e},null,8,["item"]))),128))]),_:1}),(n(!0),_(D,null,E(c.rows,e=>(n(),d(r(J),{key:e.id,row:e},{default:v(({column:p,item:a})=>[C(r(K),{item:a,align:p.align},{default:v(()=>[p.key==="status"?(n(),d(r(Q),{key:0,variant:"subtle",theme:e.status==="Paid"?s.bg_color="green":s.bg_color="red",size:"md",label:a},null,8,["theme","label"])):b("",!0),p.key==="cta"&&e.status==="Paid"?(n(),d(m,{key:1,onClick:t=>k(e),class:"hover:bg-gray-900 hover:text-white","icon-left":"download",label:"Download Invoice"},null,8,["onClick"])):b("",!0),p.key==="cta"&&(e.status==="Unpaid"||e.status==="Overdue")?(n(),d(m,{key:2,onClick:t=>$(e),class:"hover:bg-gray-900 hover:text-white flex flex-column items-center justify-center","icon-left":"credit-card",label:"Pay Now"},null,8,["onClick"])):b("",!0)]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),128))]),_:1},8,["columns","rows"])):b("",!0),g.value?(n(),d(te,{key:1,row:g.value,student:r(o),modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=e=>f.value=e),onSuccess:i[1]||(i[1]=e=>R())},null,8,["row","student","modelValue"])):b("",!0)])):(n(),_("div",ne,[C(W,{message:"No Fees found"})]))}}};export{re as default};
